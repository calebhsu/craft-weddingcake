<craft name="cake">
    <parameter name="tiers" type="int" default="2"/>
    <parameter name="width" type="int" default="30"/>
    <parameter name="rise" type="int" default="10"/>
    <parameter name="beadNumber" type="int" default="10"/>
    
    <craft name="circle-layout" module="circle-layout"/>
    
    <part name="layer">
        <g layout="centerXY()" color="ivory">
            <stack spacing="-1">
                <cylinder radius="{{(width / 2) - 1}}" height="1"></cylinder>
                
                <script>
                    function main() {
                        // Round
                        return torus({
                            ri: 1,
                            ro: (params.width / 2) - 1
                        });
                    }
                </script>
                
                <cylinder radius="{{width / 2}}" height="{{rise}}"></cylinder>
            </stack>
            
            <g color="pink">
                <circle-layout radius="{{width / 2}}">
                    <repeat n="{{beadNumber}}">
                        <sphere radius="1"></sphere>
                    </repeat>
                </circle-layout>
            </g>
        </g>
    </part>

    <script>
        function main() {
            // Stacks Multiple Layers
            var tierSize;
            var xml = '<stack>'

            for (var i = 1; i < params.tiers; i++) {
                tierSize = (1 / (params.tiers - 0.3)) * i 
                xml += '<layer transform="scale(' 
                    + tierSize + ',' + tierSize + ',' + tierSize 
                    + ')"></layer>'
            } 
            xml += '<layer></layer></stack>'
            
            return xml
        }
    </script>
    
</craft>